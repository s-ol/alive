#!/bin/sh
set -e

tmpdir=$(mktemp -d)
trap 'rm -rf "$tmpdir"' EXIT INT TERM HUP

ARGS=$*
FIFO=$tmpdir/fifo
CONF=$tmpdir/conf

cat > "$CONF" << 'EOF'
split
screen -t evaltime sh -c 'tty > "$FIFO"; read done < "$FIFO"; screen -X quit'
focus
screen -t runtime sh -c 'read tty < "$FIFO"; "alv" $ARGS 2> "$tty"; echo "[press enter to exit]"; read prompt; screen -X quit'
EOF

mkfifo "$FIFO"
export FIFO ARGS
exec screen -mc "$CONF"
